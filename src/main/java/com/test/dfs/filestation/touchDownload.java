package com.test.dfs.filestation;

import com.google.gson.Gson;
import com.netease.backend.dfs.FileInfo;
import com.netease.backend.dfs.FileStream;

import java.io.FileOutputStream;
import java.io.InputStream;

/**
 * Date: 12-1-19
 */
public class touchDownload {

	public static void main(String[] args) throws Exception {

		//long docId = 645140646620846414L;
//		if (args.length >= 1) {
//			docId = Long.valueOf(args[0]);
//		}

		DFSWrapper dfsWrapper = new DFSWrapper();

		// launch fsi manager
		String masterIp = "172.17.2.47";
		String masterPort = "5555";
		String newMasterIp = "172.17.2.165:5558,172.17.2.122:5558,172.17.0.113:5558";
		String logDir = "c:/mfslogs/";
		boolean sdfsOverallDistinct = false;
		boolean dfsOverallDistinct = true;
		dfsWrapper.launch(masterIp, masterPort, newMasterIp, logDir, sdfsOverallDistinct, dfsOverallDistinct);


		long[] longs = new long[]{131448814123960705L,168322036073039158L,320599998473448696L,341147671773359340L,341429146750070088L,343117996610334354L,347058646284294848L,353251095771931180L,356065845539034961L,359443545259563068L,363102719956810095L,364791569817074064L,364791569817074065L,365073044793780583L,365354519770495294L,365354519770496170L,367606319584176050L,368450744514306529L,378302368699182555L,378302368699182557L,378302368699182559L,378302368699182560L,378302368699182563L,379428268606026148L,382243018373126765L,383931868233393684L,385620718093657379L,388716942837476891L,388998417814179763L,389279892790896870L,389842842744318665L,394346442371687897L,394346442371687899L,397161192138799299L,398005617068931311L,401946266742849231L,403072166649721188L,407857241253774429L,414049690741408269L,415175590648251544L,423901314926281623L,425308689809834980L,431782614274178049L,433471464134433479L,438256538738514711L,455145037341164072L,455145037341164081L,456552412224718118L,457396837154849580L,462463386735635418L,462744861712352215L,463870761619195228L,464715186549326065L,481322210175263080L,483574009988947546L,485825809802633238L,485825809802633241L,485825809802633242L,485825809802633243L,485825809802633244L,485825809802633245L,488640559569739290L,490610884406715201L,491173834360135456L,491736784313557903L,495114484034082215L,502432833428561254L,504403158265536398L,510877082729881855L,511721507660011777L,514254782450411171L,515380682357252885L,518195432124358923L,519602807007912629L,520165756961328718L,530861806076330299L,535083930726998816L,538180155470815887L,540713430261237760L,540713430261237763L,544372604958474268L,545498504865315293L,547187354725578320L,548594729609130894L,548594729609136768L,549439154539267948L,549439154539269946L,549720629515976796L,549720629515980014L,550565054446107939L,552253904306374784L,558164878817297279L,558727828770718391L,560135203654269200L,563231428398056830L,577868127187013301L,579275502070566342L,582934676767804817L,583497626721226805L,587438276395175394L,595319575743071389L,595882525696495734L,600386125323865678L,603200875090971335L,611082174438868814L,611645124392292270L,612208074345713121L,614178399182687687L,616148724019659759L,63050394783212773L,635007547459259456L,635007547459263167L,639229672109922728L,639229672109923030L,645140646620846414L,650770146155059004L,653584895922165569L,663436520107039078L,663999470060459780L,666532744850855903L,680043543732967855L,711005791171140018L,720575940379302469L,732116414424439644L,735775589121678030L,743375413492866156L,747879013120236775L,769834061303667510L,771241436187220673L,783907810139198431L,788692884743281346L,796574184091180962L,93168217291227261L};
		for (long docId: longs) {
			// print sn ip
			String ip = dfsWrapper.querySNInetAddress(docId);
			System.out.println(ip);

			// print doc info
			FileInfo fileInfo = dfsWrapper.getDocInfo(docId);
			Gson gson = new Gson();
			String j = gson.toJson(fileInfo, FileInfo.class);
			System.out.println(j);

			FileStream fs = dfsWrapper.readFile(docId);
			if (fs != null) {
				InputStream is = fs.getInputStream();

				byte buf[] = new byte[1024 * 10];

				FileOutputStream stream = new FileOutputStream("d:\\" + docId, false);
				int length;
				long total = 0;
				while ((length = is.read(buf)) > 0) {
					stream.write(buf, 0, length);
					System.out.println("get: " + length);
					total += length;
				}

				System.out.println("total: " + total);
				stream.close();

				is.close();
				fs.close();
			}
		}
	}


}
